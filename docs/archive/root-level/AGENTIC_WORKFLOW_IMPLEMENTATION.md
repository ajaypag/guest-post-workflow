# Agentic Article Workflow Implementation

## Overview
This implementation adds a fully automated AI agent-powered article generation system to the existing Guest Post Workflow application using OpenAI Agents SDK.

## What's Been Added

### 1. Database Schema Extensions
- **article_sections** table: Stores individual article sections generated by the AI agent
- **agent_sessions** table: Tracks the progress and metadata of agentic workflows

### 2. Backend Services
- **AgenticArticleService** (`/lib/services/agenticArticleService.ts`): Core service managing AI agent interactions
- **API Endpoints**:
  - `POST /api/workflows/[id]/auto-generate`: Start agentic article generation
  - `GET /api/workflows/[id]/auto-generate`: Get generation progress
  - `GET /api/workflows/[id]/auto-generate/stream`: Real-time SSE updates

### 3. Frontend Components
- **AgenticArticleGenerator** (`/components/ui/AgenticArticleGenerator.tsx`): React component with real-time progress tracking
- **Updated ArticleDraftStepClean**: Added "ðŸ¤– AI Agent (Auto)" tab alongside existing ChatGPT.com and Built-in Chat options

## Key Features

### Intelligent Article Planning
- AI analyzes research outline and automatically plans article structure
- Determines optimal word count allocation per section (1500-2500 words total)
- Creates structured section roadmap before writing begins

### Section-by-Section Generation
- Writes each section individually with proper context from previous sections
- Maintains narrative flow and transitions between sections
- Enforces style rules (short paragraphs, no em-dashes, semantic SEO)

### Real-Time Progress Tracking
- Server-Sent Events (SSE) for live updates during generation
- Visual progress indicators showing current section being written
- Live word count tracking and completion status

### Error Handling & Recovery
- Comprehensive error handling for failed sections
- Session state persistence for recovery from interruptions
- Detailed logging and debugging information

## Installation Steps

### 1. Dependencies
The OpenAI Agents SDK has been automatically added to package.json:
```bash
npm install @openai/agents
```

### 2. Environment Variables
Ensure your `.env` file includes OpenAI API configuration:
```env
DATABASE_URL=your_postgresql_connection_string
OPENAI_API_KEY=your_openai_api_key
```

### 3. Database Migration
**Use the built-in migration system:**
1. Navigate to `/migrate` in your application
2. Click "Run Database Migrations" 
3. The system will automatically create all required tables including:
   - `article_sections` (for AI-generated article sections)
   - `agent_sessions` (for tracking agentic workflow progress)
   - Updated `target_pages` with `keywords` and `description` columns
   - Updated `clients` with `description` column for topic preferences

This is much easier than running manual SQL commands!

## How It Works

### User Experience
1. User completes Deep Research step (Step 3) to generate article outline
2. In Article Draft step (Step 4), user clicks "ðŸ¤– AI Agent (Auto)" tab
3. Clicks "Start Generation" to begin automated article creation
4. Watches real-time progress as AI agent:
   - Plans article structure
   - Writes title and introduction
   - Generates each subsequent section
   - Maintains narrative flow and transitions
5. Final article appears automatically in the workflow

### Technical Flow
1. **Session Creation**: Creates agent_sessions record with outline and metadata
2. **Agent Initialization**: Instantiates OpenAI Agent with function schemas
3. **Planning Phase**: Agent uses `plan_article` function to structure content
4. **Section Generation**: Agent uses `write_section` function for each part
5. **Progress Updates**: Real-time SSE updates sent to frontend
6. **Completion**: Final article saved to workflow with metadata

### Function Schemas
The AI agent has access to two primary functions:

#### plan_article
```typescript
{
  sections: Array<{title: string, word_count: number, order: number}>,
  total_word_count: number,
  writing_style_notes: string
}
```

#### write_section
```typescript
{
  section_number: number,
  content: string,
  actual_word_count: number,
  next_section_preview?: string
}
```

## Style Enforcement

### Hard Rules Applied by Agent
- **Narrative format**: Flowing prose, not bullet points
- **Short paragraphs**: 2-3 lines maximum
- **No em-dashes**: Specifically prohibited
- **Natural transitions**: Each section flows to the next
- **Semantic SEO**: Proper keyword integration and heading structure

### Content Quality
- Citations limited to 3 maximum per article
- Context-rich content addressing user intent
- Professional, engaging tone throughout
- Proper heading hierarchy (H2 for sections)

## Integration Points

### Existing Workflow Compatibility
- Works alongside existing ChatGPT.com and Built-in Chat options
- Uses same outline input from Deep Research step
- Saves output in same format as manual workflows
- Maintains all existing workflow metadata

### Database Integration
- Leverages existing workflow and user systems
- Extends schema without breaking existing functionality
- Maintains referential integrity with cascade deletes

## Testing

### Manual Testing
1. Create a new workflow with a client
2. Complete Steps 1-3 to generate research outline
3. Navigate to Step 4 (Article Draft)
4. Switch to "ðŸ¤– AI Agent (Auto)" tab
5. Click "Start Generation" and observe progress
6. Verify final article quality and formatting

### API Testing
```bash
# Test generation start
curl -X POST /api/workflows/[workflow-id]/auto-generate \
  -H "Content-Type: application/json" \
  -d '{"outline": "your_research_outline_here"}'

# Test progress monitoring
curl /api/workflows/[workflow-id]/auto-generate?sessionId=[session-id]

# Test SSE stream
curl /api/workflows/[workflow-id]/auto-generate/stream?sessionId=[session-id]
```

## Monitoring & Debugging

### Logging
- All agent interactions logged with timestamps
- Section generation progress tracked in database
- Error states preserved for debugging
- Performance metrics (word count, timing) recorded

### Debugging Tools
- Admin panel access to agent_sessions table
- Real-time progress display in UI
- Detailed error messages for failed generations
- Session metadata for troubleshooting

## Future Enhancements

### Potential Improvements
1. **Multiple AI Models**: Support for different OpenAI models (GPT-4, o3, etc.)
2. **Custom Style Profiles**: User-configurable writing styles per client
3. **Revision Workflows**: AI-powered editing and improvement cycles
4. **Batch Processing**: Generate multiple articles simultaneously
5. **Quality Scoring**: Automated content quality assessment

### Scalability Considerations
- Rate limiting for OpenAI API calls
- Queue system for multiple concurrent generations
- Caching for repeated outline patterns
- Performance optimization for large articles

## Support

### Common Issues
- **Session timeouts**: Check database connection and agent session status
- **Generation failures**: Review error_message in agent_sessions table
- **Missing outline**: Ensure Deep Research step is completed first
- **API rate limits**: Monitor OpenAI usage and implement backoff strategies

### Troubleshooting
1. Check database migrations applied correctly
2. Verify OpenAI API key configuration
3. Monitor browser console for SSE connection issues
4. Review server logs for agent service errors

This implementation transforms the manual article writing process into a fully automated, intelligent system while maintaining compatibility with existing workflows and providing comprehensive monitoring and error handling.